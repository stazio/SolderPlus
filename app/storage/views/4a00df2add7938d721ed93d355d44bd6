<?php $__env->startSection('title'); ?>
    <title>Update Checker - TechnicSolder</title>
<?php $__env->stopSection(); ?>
<?php $__env->startSection('content'); ?>
<div class="row">
	<div class="page-header">
	<h1>Update Manager</h1>
	</div>
</div>
<div class="row">
	<div class="col-lg-6">
		<div class="panel panel-default">
			<div class="panel-heading">
		    Solder Versioning
		    </div>
		    <div class="panel-body">
		        <label>Current Version: <span class="label label-default"><?php echo $currentVersion; ?></span></label><br>
		        <label>Latest Version: 
                <?php if(is_array($latestData['version']) && array_key_exists('error', $latestData['version'])): ?>
                <span class="label label-danger"><?php echo $latestData['version']['error']; ?></span>
                <?php else: ?>
                <span class="label label-default"><?php echo $latestData['version']; ?></span>
                <?php endif; ?>
                </label><br>
                <label>Latest Commit: 
                <?php if(array_key_exists('error', $changelog)): ?>
                <span class="label label-danger"><?php echo $latestData['commit']['error']; ?></span>
                <?php else: ?>
		        <span class="label label-default"><?php echo $latestData['commit']['sha']; ?></span>
                <?php endif; ?>
                </label><br>
			</div>
		</div>
        <div class="panel panel-default">
            <div class="panel-heading">
            Update Check
            </div>
            <div class="panel-body">
                <?php if(Cache::get('update')): ?>
                <p id='solder-update-ajax' class="alert alert-danger">Solder is out of date. Please refer to the wiki on how to update.</p>                
                <?php else: ?>
                <p id='solder-update-ajax' class="alert alert-success">Solder is up to date</p>
                <?php endif; ?>
                <a href="http://docs.solder.io/v0.7/docs/updating-solder" target="blank_"><button id='solder-wiki' class="btn btn-default">Updating Solder <i class="fa fa-question"></i></button></a>
                <button id='solder-update' type="submit" class="btn btn-default">Check for update</button>
                <span id="solder-checking" style="margin-left:10px;" class="hidden"><i class="fa fa-cog fa-spin"></i> Checking...</span>
            </div>
        </div>
	</div>
	<div class="col-lg-6">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-clock-o fa-fw"></i> Activity Panel</h3>
            </div>
            <div class="panel-body">
                <div class="list-group">
                    <?php if(array_key_exists('error', $changelog)): ?>
                    <div class="alert alert-warning"><?php echo $changelog['error']; ?></div>
                    <?php else: ?>
                	<?php foreach($changelog as $change): ?>
                    <a href="<?php echo $change['html_url']; ?>" target="blank_" class="list-group-item">
                        <span class="badge" style="margin-left:5px;"><?php echo date_format(date_create($change['commit']['author']['date']), 'M, d, Y | g:i a'); ?></span>
                        <img src="<?php echo $change['author']['avatar_url']; ?>" alt="<?php echo $change['author']['login']; ?>" height="23" width="23"> <?php echo $change['commit']['message']; ?>

                    </a>
                    <?php endforeach; ?>
                    <?php endif; ?>               
                </div>
                <div class="text-right">
                    <a href="https://github.com/TechnicPack/TechnicSolder/commits/master">View All Activity <i class="fa fa-arrow-circle-right"></i></a>
                </div>
            </div>
        </div>
    </div>
</div>
<?php $__env->stopSection(); ?>
<?php $__env->startSection('bottom'); ?>
<script type="text/javascript">

$('#solder-update').click(function(e) {
    $("#solder-checking").removeClass("hidden");
    $("#solder-update-ajax").fadeOut();
    e.preventDefault();
    $.ajax({
        type: "GET",
        url: "<?php echo URL::to('solder/update-check/'); ?>/",
        success: function (data) {
            if (data.status == "success") {
                if(data.update) {
                    $("#solder-update-ajax").removeClass("alert-warning alert-success alert-danger").addClass("alert-danger").html('Solder is out of date. Please refer to the wiki on how to update.').fadeIn();
                } else {
                    $("#solder-update-ajax").removeClass("alert-warning alert-success alert-danger").addClass("alert-success").html('Solder is up to date.').fadeIn();
                }
            } else {
                $("#solder-update-ajax").removeClass("alert-warning alert-success alert-danger").addClass("alert-danger").html('Error checking for update. ' + data.reason);
            }
            $("#solder-checking").addClass("hidden");
        },
        error: function (xhr, textStatus, errorThrown) {
            $("#solder-update-ajax").removeClass("alert-warning alert-success alert-danger").addClass("alert-danger").html('Error checking for update. ' + textStatus + ': ' + errorThrown);
            $("#solder-checking").addClass("hidden");
        }
    });
});

</script>
<?php $__env->stopSection(); ?>
<?php echo $__env->make('layouts/master', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>